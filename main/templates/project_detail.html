{% extends "base.html" %}
{% load static %}

{% block seo_meta %}
<meta name="description" content="{{ project.title }} - Complete project details and requirements. Get expert guidance from Zerazone.">
<meta name="keywords" content="{{ project.title }}, final year project, project details, Zerazone">
<meta name="author" content="Zerazone">
{% endblock %}

{% block og_meta %}
<meta property="og:type" content="article">
<meta property="og:site_name" content="Zerazone">
<meta property="og:title" content="{{ project.title }} - Zerazone">
<meta property="og:description" content="{{ project.description|truncatewords:30 }}">
<meta property="og:url" content="https://www.zerazone.com/projects/{{ project.pk }}">
<meta property="og:image" content="https://www.zerazone.com/static/images/logo1.png">
{% endblock %}

{% block content %}

<!-- LOADER -->
<div id="preloader">
    <img class="preloader" src="{% static 'images/loader.gif' %}" alt="">
</div>

<!-- WhatsApp Floating Button -->
<a href="https://wa.me/919061643216?text=Hi%20Zerazone,%20I'm%20interested%20in%20the%20project:%20{{ project.title }}" class="whatsapp-float" target="_blank" title="Chat with us on WhatsApp">
    <i class="fa fa-whatsapp whatsapp-icon"></i>
</a>

<div id="wrapper">

    <!-- Page Title Section -->
    <section class="section cb parallax" style="background: url('{% static 'images/pattern.png' %}') repeat center center rgba(0, 0, 0, 0.85); padding: 100px 0 80px;">
        <div class="container">
            <div class="row">
                <div class="col-md-12 text-center">
                    <div class="page-title">
                        <h3 style="color: #ffffff; font-size: 42px; margin-bottom: 15px;">Project Details</h3>
                        <ol class="breadcrumb">
                            <li><a href="{% url 'home' %}">Home</a></li>
                            <li><a href="{% url 'projects' %}">Projects</a></li>
                            <li class="active">{{ project.title|truncatewords:5 }}</li>
                        </ol>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Project Detail Section -->
    <section class="section">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-md-8">
                    <!-- Back Button -->
                    <div style="margin-bottom: 30px;">
                        <a href="{% url 'projects' %}" class="bt btn-defaul" style="padding: 10px 25px;">
                            <i class="fa fa-arrow-left"></i> Back to Projects
                        </a>
                    </div>

                    <!-- Project Card -->
                    <div class="project-detail-box" style="background: #ffffff; padding: 40px; border-radius: 8px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); margin-bottom: 30px;">
                        <!-- Project Header -->
                        <div class="project-header" style="border-bottom: 3px solid #01bacf; padding-bottom: 20px; margin-bottom: 30px;">
                            <h1 style="font-size: 32px; color: #333; margin-bottom: 15px; line-height: 1.3;">
                                {{ project.title }}
                            </h1>
                            <p style="color: #777; font-size: 14px; margin-bottom: 0;">
                                <i class="fa fa-calendar"></i> Posted on {{ project.created_at|date:"F d, Y" }}
                            </p>
                        </div>

                        <!-- Project Description -->
                        <div class="project-description">
                            <h3 style="color: #01bacf; margin-bottom: 20px; font-size: 22px;">
                                <i class="fa fa-file-text-o"></i> Project Overview
                            </h3>
                            <div style="color: #555; font-size: 16px; line-height: 1.8; white-space: pre-wrap; text-align: justify;">
                                {{ project.description }}
                            </div>
                        </div>

                        <!-- Share Section -->
                        <div style="margin-top: 40px; padding-top: 30px; border-top: 1px solid #eee;">
                            <h4 style="color: #333; margin-bottom: 15px;">
                                <i class="fa fa-share-alt"></i> Share This Project
                            </h4>
                            <div class="share-buttons">
                                <a href="https://www.facebook.com/sharer/sharer.php?u={{ request.build_absolute_uri }}" target="_blank" class="share-btn facebook" title="Share on Facebook">
                                    <i class="fa fa-facebook"></i>
                                </a>
                                <a href="https://twitter.com/intent/tweet?text={{ project.title }}&url={{ request.build_absolute_uri }}" target="_blank" class="share-btn twitter" title="Share on Twitter">
                                    <i class="fa fa-twitter"></i>
                                </a>
                                <a href="https://www.linkedin.com/shareArticle?mini=true&url={{ request.build_absolute_uri }}&title={{ project.title }}" target="_blank" class="share-btn linkedin" title="Share on LinkedIn">
                                    <i class="fa fa-linkedin"></i>
                                </a>
                                <a href="https://wa.me/?text=Check out this project: {{ project.title }} - {{ request.build_absolute_uri }}" target="_blank" class="share-btn whatsapp" title="Share on WhatsApp">
                                    <i class="fa fa-whatsapp"></i>
                                </a>
                            </div>
                        </div>
                    </div>

                </div>

                <!-- Sidebar -->
                <div class="col-lg-4 col-md-4">
                    <!-- Enquiry Box -->
                    <div class="sidebar-box" style="background: linear-gradient(135deg, #66bcea 0%, #0e5068 100%); padding: 30px; border-radius: 8px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); margin-bottom: 30px; color: white; text-align: center;">
                        <i class="fa fa-info-circle" style="font-size: 50px; margin-bottom: 20px; opacity: 0.9;"></i>
                        <h4 style="color: white; margin-bottom: 15px; font-size: 22px;">Interested in This Project?</h4>
                        <p style="margin-bottom: 25px; opacity: 0.95;">Get complete source code, documentation, and expert guidance!</p>
                        
                        <!-- Download Abstract Button -->
                        <a href="#" data-toggle="modal" data-target="#download-abstract-modal" class="btn btn-warning" style="width: 100%; padding: 12px; margin-bottom: 10px; font-weight: 600; color: #333; background: #ffc107; border: none;">
                            <i class="fa fa-download"></i> Download Abstract
                        </a>
                        
                        <a href="#" data-toggle="modal" data-target="#enquiry-modal" class="btn btn-light" style="width: 100%; padding: 12px; margin-bottom: 10px; font-weight: 600; color: #0e5068;">
                            <i class="fa fa-paper-plane"></i> Enquire Now
                        </a>
                        <a href="https://wa.me/919061643216?text=Hi%20Zerazone,%20I'm%20interested%20in%20the%20project:%20{{ project.title }}" class="btn btn-success" target="_blank" style="width: 100%; padding: 12px; font-weight: 600; background: #25d366; border: none;">
                            <i class="fa fa-whatsapp"></i> WhatsApp Us
                        </a>
                    </div>

                    <!-- What You'll Get -->
                    <div class="sidebar-box" style="background: #ffffff; padding: 25px; border-radius: 8px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); margin-bottom: 30px;">
                        <h4 style="color: #333; margin-bottom: 20px; font-size: 18px; border-bottom: 2px solid #01bacf; padding-bottom: 10px;">
                            <i class="fa fa-gift"></i> What You'll Get
                        </h4>
                        <ul style="color: #666; line-height: 2.2; list-style: none; padding-left: 0; font-size: 14px;">
                            <li><i class="fa fa-check-circle" style="color: #01bacf; margin-right: 10px;"></i> Complete Source Code</li>
                            <li><i class="fa fa-check-circle" style="color: #01bacf; margin-right: 10px;"></i> Project Documentation Support</li>
                            <li><i class="fa fa-check-circle" style="color: #01bacf; margin-right: 10px;"></i> PPT Presentation Support</li>
                            <li><i class="fa fa-check-circle" style="color: #01bacf; margin-right: 10px;"></i> Project Report Support</li>
                            <li><i class="fa fa-check-circle" style="color: #01bacf; margin-right: 10px;"></i> Installation Guide</li>
                            <li><i class="fa fa-check-circle" style="color: #01bacf; margin-right: 10px;"></i> Viva Preparation Support</li>
                        </ul>
                    </div>

                    <!-- Contact Info -->
                    <div class="sidebar-box" style="background: #f9f9f9; padding: 25px; border-radius: 8px; border-left: 4px solid #01bacf; margin-bottom: 30px;">
                        <h4 style="color: #333; margin-bottom: 20px; font-size: 18px;">
                            <i class="fa fa-phone"></i> Need Help?
                        </h4>
                        <p style="color: #666; font-size: 14px; line-height: 1.8; margin-bottom: 15px;">
                            Our team is available to answer all your questions about this project.
                        </p>
                        <p style="margin-bottom: 10px;">
                            <strong style="color: #333;"><i class="fa fa-phone" style="color: #01bacf;"></i> Call:</strong><br>
                            <a href="tel:+919061643216" style="color: #01bacf; font-size: 16px;">+91 9061643216</a>
                        </p>
                        <p style="margin-bottom: 10px;">
                            <strong style="color: #333;"><i class="fa fa-envelope" style="color: #01bacf;"></i> Email:</strong><br>
                            <a href="mailto:zerazone2025@gmail.com" style="color: #01bacf; font-size: 14px; word-break: break-all;">zerazone2025@gmail.com</a>
                        </p>
                        <p style="margin-bottom: 0;">
                            <strong style="color: #333;"><i class="fa fa-clock-o" style="color: #01bacf;"></i> Hours:</strong><br>
                            <span style="color: #666; font-size: 14px;">Mon-Sat: 9 AM - 8 PM</span>
                        </p>
                    </div>

                    <!-- Popular Domains -->
                    <div class="sidebar-box" style="background: #ffffff; padding: 25px; border-radius: 8px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">
                        <h4 style="color: #333; margin-bottom: 20px; font-size: 18px; border-bottom: 2px solid #01bacf; padding-bottom: 10px;">
                            <i class="fa fa-tag"></i> Popular Domains
                        </h4>
                        <div class="tags-widget">   
                            <ul class="list-inline" style="margin-bottom: 0;">
                                <li><a href="#" data-toggle="modal" data-target="#enquiry-modal" style="display: inline-block; padding: 6px 12px; background: #54b2dbff; color: #666; border-radius: 4px; margin: 5px 3px; font-size: 13px; text-decoration: none; transition: all 0.3s;">Python</a></li>
                                <li><a href="#" data-toggle="modal" data-target="#enquiry-modal" style="display: inline-block; padding: 6px 12px; background: #54b2dbff; color: #666; border-radius: 4px; margin: 5px 3px; font-size: 13px; text-decoration: none; transition: all 0.3s;">Machine Learning</a></li>
                                <li><a href="#" data-toggle="modal" data-target="#enquiry-modal" style="display: inline-block; padding: 6px 12px; background: #54b2dbff; color: #666; border-radius: 4px; margin: 5px 3px; font-size: 13px; text-decoration: none; transition: all 0.3s;">Django</a></li>
                                <li><a href="#" data-toggle="modal" data-target="#enquiry-modal" style="display: inline-block; padding: 6px 12px; background: #54b2dbff; color: #666; border-radius: 4px; margin: 5px 3px; font-size: 13px; text-decoration: none; transition: all 0.3s;">MEAN Stack</a></li>
                                <li><a href="#" data-toggle="modal" data-target="#enquiry-modal" style="display: inline-block; padding: 6px 12px; background: #54b2dbff; color: #666; border-radius: 4px; margin: 5px 3px; font-size: 13px; text-decoration: none; transition: all 0.3s;">Data Science</a></li>
                                <li><a href="#" data-toggle="modal" data-target="#enquiry-modal" style="display: inline-block; padding: 6px 12px; background: #54b2dbff; color: #666; border-radius: 4px; margin: 5px 3px; font-size: 13px; text-decoration: none; transition: all 0.3s;">Android</a></li>
                                <li><a href="#" data-toggle="modal" data-target="#enquiry-modal" style="display: inline-block; padding: 6px 12px; background: #54b2dbff; color: #666; border-radius: 4px; margin: 5px 3px; font-size: 13px; text-decoration: none; transition: all 0.3s;">Web Dev</a></li>
                                <li><a href="#" data-toggle="modal" data-target="#enquiry-modal" style="display: inline-block; padding: 6px 12px; background: #54b2dbff; color: #666; border-radius: 4px; margin: 5px 3px; font-size: 13px; text-decoration: none; transition: all 0.3s;">AI</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Call to Action -->
    <section class="section db p120">
        <div class="container">
            <div class="row">
                <div class="col-md-12">
                    <div class="tagline-message text-center">
                        <h3>Ready to Start This Project?</h3>
                        <p style="color: #ffffff; font-size: 18px; margin: 20px 0;">Get complete guidance from our expert team. We're here to help you succeed!</p>
                        <a href="tel:+919061643216" class="btn btn-primary" style="margin-right: 10px; padding: 15px 35px;">
                            <i class="fa fa-phone"></i> Call Now
                        </a>
                        <a href="{% url 'contact' %}" class="btn btn-secondary" style="padding: 15px 35px;">
                            <i class="fa fa-envelope"></i> Contact Us
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Download Abstract Modal -->
    <div class="modal fade" id="download-abstract-modal" tabindex="-1" role="dialog" aria-labelledby="downloadAbstractModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content" style="border-radius: 8px; overflow: hidden;">
                <div class="modal-header" style="background: linear-gradient(135deg, #66bcea 0%, #0e5068 100%); color: white; border: none; padding: 20px 30px;">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close" style="color: white; opacity: 0.9; font-size: 30px; margin-top: -5px;">
                        <span aria-hidden="true">&times;</span>
                    </button>
                    <h4 class="modal-title" id="downloadAbstractModalLabel" style="margin: 0; font-size: 20px;">
                        <i class="fa fa-download"></i> Download Project Abstract
                    </h4>
                </div>
                <div class="modal-body" style="padding: 30px;">
                    <p style="color: #666; margin-bottom: 25px; font-size: 15px;">Please provide your details to download the project abstract as PDF.</p>
                    
                    <form id="download-abstract-form">
                        {% csrf_token %}
                        <input type="hidden" name="project_id" value="{{ project.pk }}">
                        <input type="hidden" name="project_title" value="{{ project.title }}">
                        
                        <div class="form-group">
                            <label for="download_name" style="color: #333; font-weight: 600; margin-bottom: 8px;">Full Name <span style="color: red;">*</span></label>
                            <input type="text" class="form-control" id="download_name" name="name" required style="height: 45px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;">
                        </div>
                        
                        <div class="form-group">
                            <label for="download_email" style="color: #333; font-weight: 600; margin-bottom: 8px;">Email Address <span style="color: red;">*</span></label>
                            <input type="email" class="form-control" id="download_email" name="email" required style="height: 45px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;">
                        </div>
                        
                        <div class="form-group">
                            <label for="download_phone" style="color: #333; font-weight: 600; margin-bottom: 8px;">Phone Number <span style="color: red;">*</span></label>
                            <input type="tel" class="form-control" id="download_phone" name="phone" required style="height: 45px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;">
                            <small id="phone-error" style="color: red; display: none; margin-top: 5px;"></small>
                        </div>
                        
                        <div class="form-group">
                            <label for="download_college" style="color: #333; font-weight: 600; margin-bottom: 8px;">College/Institution</label>
                            <input type="text" class="form-control" id="download_college" name="college" style="height: 45px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;">
                        </div>
                        
                        <div class="form-group" style="margin-bottom: 0; margin-top: 25px;">
                            <button type="submit" id="download-btn" class="btn btn-primary btn-block" style="height: 50px; font-size: 16px; font-weight: 600; background: linear-gradient(135deg, #66bcea 0%, #0e5068 100%); border: none; transition: all 0.3s;">
                                <i class="fa fa-download"></i> Download PDF Abstract
                            </button>
                        </div>
                    </form>
                    
                    <div id="download-message" style="margin-top: 20px; display: none;"></div>
                </div>
            </div>
        </div>
    </div>

</div>

<style>
    .btn-primary {
        background: linear-gradient(135deg, #66bcea 0%, #0e5068 100%);
        border: none;
        transition: all 0.3s ease;
    }

    .btn-primary:hover {
        background: linear-gradient(135deg, #0e5068 0%, #66bcea 100%);
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(1, 186, 207, 0.3);
    }

    .btn-default {
        background: #ffffff;
        border: 2px solid #666;
        color: #666;
        transition: all 0.3s ease;
    }

    .btn-default:hover {
        background: #666;
        color: #ffffff;
        transform: translateY(-2px);
        border-color: #666;
    }

    .btn-light:hover {
        background: #f8f9fa !important;
        color: #0e5068 !important;
    }

    .btn-warning:hover {
        background: #ffb300 !important;
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(255, 193, 7, 0.3);
    }

    /* Share Buttons */
    .share-buttons {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
    }

    .share-btn {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 45px;
        height: 45px;
        border-radius: 50%;
        color: white;
        font-size: 20px;
        transition: all 0.3s ease;
        text-decoration: none;
    }

    .share-btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        color: white;
    }

    .share-btn.facebook {
        background: #3b5998;
    }

    .share-btn.twitter {
        background: #1da1f2;
    }

    .share-btn.linkedin {
        background: #0077b5;
    }

    .share-btn.whatsapp {
        background: #25d366;
    }

    /* Tag hover effect */
    .tags-widget a:hover {
        background: linear-gradient(135deg, #66bcea 0%, #0e5068 100%) !important;
        color: white !important;
        transform: translateY(-2px);
        box-shadow: 0 3px 10px rgba(1, 186, 207, 0.3);
    }

    /* Form Focus Effect */
    .form-control:focus {
        border-color: #01bacf;
        box-shadow: 0 0 0 0.2rem rgba(1, 186, 207, 0.25);
    }

    /* Modal Close Button */
    .modal-header .close:hover {
        opacity: 1;
    }

    /* Responsive */
    @media (max-width: 991px) {
        .sidebar-box {
            margin-top: 30px;
        }
    }

    @media (max-width: 768px) {
        .project-detail-box {
            padding: 25px 20px !important;
        }

        .project-header h1 {
            font-size: 24px !important;
        }

        section.db.p120 {
            padding: 60px 0 !important;
        }

        .modal-dialog {
            margin: 10px;
        }

        .modal-body {
            padding: 20px !important;
        }
    }
</style>

<script>
    // Smooth scroll
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
            if (this.getAttribute('href') !== '#' && !this.hasAttribute('data-toggle')) {
                e.preventDefault();
                var target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            }
        });
    });

    // Phone number validation
    function validatePhone(phone) {
        // Remove all non-digit characters
        const cleaned = phone.replace(/\D/g, '');
        
        // Check if it's a valid length (between 7 and 15 digits)
        if (cleaned.length < 7 || cleaned.length > 15) {
            return {
                valid: false,
                message: 'Phone number must be between 7 and 15 digits'
            };
        }
        
        // Check if it's all zeros
        if (/^0+$/.test(cleaned)) {
            return {
                valid: false,
                message: 'Please enter a valid phone number'
            };
        }
        
        // Check if it's a valid pattern (optional: you can add country-specific validation)
        if (!/^[0-9]+$/.test(cleaned)) {
            return {
                valid: false,
                message: 'Phone number can only contain digits'
            };
        }
        
        return {
            valid: true,
            cleaned: cleaned
        };
    }

    // Real-time phone validation
    document.getElementById('download_phone').addEventListener('input', function(e) {
        const phoneError = document.getElementById('phone-error');
        const validation = validatePhone(this.value);
        
        if (this.value && !validation.valid) {
            phoneError.textContent = validation.message;
            phoneError.style.display = 'block';
            this.style.borderColor = '#dc3545';
        } else {
            phoneError.style.display = 'none';
            this.style.borderColor = '#ddd';
        }
    });

    // Download Abstract Form Handler
    document.getElementById('download-abstract-form').addEventListener('submit', function(e) {
        e.preventDefault();
        
        // Validate phone number before submission
        const phoneInput = document.getElementById('download_phone');
        const phoneValidation = validatePhone(phoneInput.value);
        
        if (!phoneValidation.valid) {
            const phoneError = document.getElementById('phone-error');
            phoneError.textContent = phoneValidation.message;
            phoneError.style.display = 'block';
            phoneInput.style.borderColor = '#dc3545';
            phoneInput.focus();
            return;
        }
        
        const submitBtn = document.getElementById('download-btn');
        const originalText = submitBtn.innerHTML;
        submitBtn.innerHTML = '<i class="fa fa-spinner fa-spin"></i> Generating PDF...';
        submitBtn.disabled = true;
        
        const formData = new FormData(this);
        // Add cleaned phone number
        formData.set('phone', phoneValidation.cleaned);
        
        fetch("{% url 'download_project_abstract' %}", {
            method: 'POST',
            body: formData,
            headers: {
                'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
            }
        })
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            return response.blob();
        })
        .then(blob => {
            // Create download link
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'Project_Abstract_{{ project.title|slugify }}.pdf';
            document.body.appendChild(a);
            a.click();
            window.URL.revokeObjectURL(url);
            document.body.removeChild(a);
            
            // Show success message
            document.getElementById('download-message').innerHTML = 
                '<div class="alert alert-success" style="margin: 0; padding: 15px; border-radius: 4px; background: #d4edda; border: 1px solid #c3e6cb; color: #155724;"><i class="fa fa-check-circle"></i> PDF downloaded successfully!</div>';
            document.getElementById('download-message').style.display = 'block';
            
            // Reset form
            document.getElementById('download-abstract-form').reset();
            document.getElementById('phone-error').style.display = 'none';
            document.getElementById('download_phone').style.borderColor = '#ddd';
            
            // Close modal after 2 seconds
            setTimeout(function() {
                $('#download-abstract-modal').modal('hide');
                document.getElementById('download-message').style.display = 'none';
            }, 2000);
        })
        .catch(error => {
            console.error('Error:', error);
            document.getElementById('download-message').innerHTML = 
                '<div class="alert alert-danger" style="margin: 0; padding: 15px; border-radius: 4px; background: #f8d7da; border: 1px solid #f5c6cb; color: #721c24;"><i class="fa fa-exclamation-circle"></i> Error downloading PDF. Please try again.</div>';
            document.getElementById('download-message').style.display = 'block';
        })
        .finally(() => {
            submitBtn.innerHTML = originalText;
            submitBtn.disabled = false;
        });
    });

    // Reset form when modal is closed
    $('#download-abstract-modal').on('hidden.bs.modal', function () {
        document.getElementById('download-abstract-form').reset();
        document.getElementById('download-message').style.display = 'none';
        document.getElementById('phone-error').style.display = 'none';
        document.getElementById('download_phone').style.borderColor = '#ddd';
    });
</script>

{% endblock content %}